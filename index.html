<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Decoding CAPTCHA's in Python for Fun and Profit</title>
		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Decoding CAPTCHA's for Fun and Profit</h1>
					<h3>Using Python</h3>
					<p>
						<small>Ben Boyter / <a href="http://twitter.com/boyter">@boyter</a></small>
					</p>
				</section>

				<section>
					<h2>Legal/Disclaimer</h2>
					<p>This information is solely for information and educational purposes. I do not condone the use or act of ethical or unethical “hacking” nor circumvention of copy protection etc... The use of this code for any unethical or illegal purposes is not condoned by myself nor any other person(s) mentioned in this presentation.</p>
				</section>

				<section>
					<h2>What is a CAPTCHA?</h2>
					<p>A CAPTCHA is basically just an implementation of a one way function.</p>
					<p>Another example would be a hash function such as MD5 or SHA1</p>
					<pre><code data-trim contenteditable>
>>> hashlib.md5("captcha").hexdigest()
'70b29c4920daf4e51e8175179027e668'
					</code></pre>
					<p>One important difference! It should be easy for the human to reverse and not a computer.</p>
				</section>

				<section>
					<h2>Why Would you Release This?!</h2>
					<p><a href="http://www.boyter.org/decoding-captchas/">http://www.boyter.org/decoding-captchas/</a></p>
					<p>There are some excellent tutorials and many published papers on it they are very light on algorithms or sample code.</p>
					<p>It's what I wish existed when I was looking into the space.</p>
					<p>Although I sometimes wish that had not...</p>
				</section>

				

				<section>
					<h2>Example / Weaknesses</h2>
					<p><img width="100%" src="./code/captcha.gif" />
						Real life CAPTCHA (at the time) Some noise, but this is not a huge problem.
					</p>
					<p>
						Single colour background, constant font, no mixing of case, characters aligned, no rotation, no deformation, same colour font, etc...
					</p>
				</section>

				<section>
					<h2>Extracting Text (DEMO)</h2>
					<p>Multivalued Image Decomposition</p>
					<pre><code data-trim contenteditable>
from PIL import Image
from operator import itemgetter

im = Image.open("captcha.gif")
im = im.convert("P")
his = im.histogram()

values = {}
for i in range(256):
  values[i] = his[i]

print his

for j, k in sorted(values.items(), key=itemgetter(1), reverse=True)[:10]:
  print j, k</code></pre>
  					<small>Other options include edge detection, horizontal blur, disjoint sets etc...</small>
				</section>

				<section>
					<h2>Result</h2>
					<p>Pixel set 220</p>
					<p><img width="60%" src="./code/output.220.gif" /></p>
					<p>Pixel sets 220 and 227</p>
					<p><img width="60%" src="./code/output.gif" /></p>
				</section>

				<section>
					<h2>Identifying Character Locations</h2>
					
					<img width="45%" src="./code/output.blur.png">
					<img width="45%" src="./code/output.fixed.png">
					<img width="45%" src="./code/output.slice.png">
					<img width="45%" src="./code/output.letter.png">

					<p>How to know where the characters are?</p>
					<p>Horizontal blur, fixed positions, vertical slices, letter dip checks, extract and test, disjoint sets.</p>

				</section>


				<section>
					<h2>Identifying Character Locations (DEMO)</h2>
					<p>Vertical Slices</p>
					<pre><code data-trim contenteditable>
					for y in range(im2.size[0]): # slice across
  for x in range(im2.size[1]): # slice down
    pix = im2.getpixel((y,x))
    if pix != 255:
      inletter = True
  if foundletter == False and inletter == True:
    foundletter = True
    start = y

  if foundletter == True and inletter == False:
    foundletter = False
    end = y
    letters.append((start,end))

  inletter=False
</code></pre>

				</section>

				<section>
					<h2>Result</h2>
					<p>Each character is extracted</p>
					<img width="80" height="200" src="./code/a95c10689bd19a2f1aa5c32966711974.gif" />
					<img width="80" height="200" src="./code/7f18fb9f4ef59f1e37ccd4001d2ec951.gif" />
					<img width="80" height="200" src="./code/1a09aeb0d13b9ed9b6c8c0b9c4f3a2db.gif" />
					<img width="80" height="200" src="./code/21074e48f1873999825fefc4b69c068e.gif" />
					<img width="80" height="200" src="./code/910c9cd8ecf1799cd5f2c8bd01fa7f1a.gif" />
					<img width="80" height="200" src="./code/4cb958a1b03e7507ba261ef8d7e58035.gif" />
				</section>

				<section>
					<h2>Image Recognition</h2>

					<p>Multiple options, neural network, support vector machines, bayesian classifier, vector space models, etc...</p>
					<p>Each has its strengths and weaknesses.</p>

				</section>

				<section>
					<h2>Vector Space</h2>
					<pre><code data-trim contenteditable>
					import math

class VectorCompare:
  def magnitude(self,concordance):
    total = 0
    for word,count in concordance.iteritems():
      total += count ** 2
    return math.sqrt(total)

  def relation(self,concordance1, concordance2):
    relevance = 0
    topvalue = 0
    for word, count in concordance1.iteritems():
      if concordance2.has_key(word):
        topvalue += count * concordance2[word]
    return topvalue / (self.magnitude(concordance1) * self.magnitude(concordance2))
</code></pre>
<p><a href="http://www.boyter.org/2011/06/vector-space-search-model-explained/">Vector Space Explained</a>, works by finding the sortest distance between points in multidimensional space.</p>
				</section>

				<section>
					<h2>Training Set</h2>
					
					<p>The rule with training sets,</p>

					<blockquote>
						&ldquo;One to train, one to verify&rdquo;
					</blockquote>

					<p>Could build a corpus using random fonts with slight deformations.</p>
					<p>But we can already extract the characters...</p>
				</section>

				<section>
					<h2>Building the Corpus (DEMO)</h2>
					
					<p>Download many CAPTCHA's and solve the manually. Use this to build the corpus.</p>
<pre><code data-trim contenteditable>
count = 0
for letter in letters:
  m = hashlib.md5()
  im3 = im2.crop(( letter[0] , 0, letter[1],im2.size[1] ))
  m.update("%s%s"%(time.time(),count))
  im3.save("./%s.gif"%(m.hexdigest()))
  count += 1
</code></pre>
				</section>



			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
